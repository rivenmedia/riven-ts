import assert from "node:assert";
import { {{pascalCase pluginName}}API } from "../../datasource/{{kebabCase pluginName}}.datasource.ts";
import { it } from "@repo/core-util-vitest-test-context";
import { expect } from "vitest";
import { http, HttpResponse } from "msw";

it('returns the validation status when calling "{{camelCase pluginName}}IsValid" query', async ({
  gqlServer,
  httpCache,
  server,
}) => {
  server.use(
    http.get("**/validate", () => HttpResponse.json({ success: true })),
  )

  const { body } = await gqlServer.executeOperation(
    {
      query: `
        query {{pascalCase pluginName}}IsValid {
          {{camelCase pluginName}}IsValid
        }
      `,
    },
    {
      contextValue: {
        dataSources: {
          {{camelCase pluginName}}: new {{pascalCase pluginName}}API({ cache: httpCache, token: "test-token" }),
        },
      },
    },
  );

  assert(body.kind === "single");

  expect(body.singleResult.errors).toBeUndefined();
  expect(body.singleResult.data?.["{{camelCase pluginName}}IsValid"]).toBe(true);
});
