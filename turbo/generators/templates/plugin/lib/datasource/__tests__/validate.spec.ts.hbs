import { it } from "@repo/util-plugin-testing";

import { http, HttpResponse } from "msw";
import { expect } from "vitest";

import { pluginConfig } from "../../{{kebabCase pluginName}}-plugin.config.ts";
import { {{pascalCase pluginName}}API } from "../{{kebabCase pluginName}}.datasource.ts";

it("returns false if the request fails", async ({
  server,
  dataSourceConfig,
}) => {
  server.use(
    http.get("**/validate", () => HttpResponse.json({ success: false }, { status: 401 })),
  )

  const {{camelCase pluginName}}Api = new {{pascalCase pluginName}}API({
    ...dataSourceConfig,
    pluginSymbol: pluginConfig.name,
    settings: {},
  });
  const isValid = await {{camelCase pluginName}}Api.validate();

  expect(isValid).toBe(false);
});

it("returns true if the request succeeds", async ({
  server,
  dataSourceConfig,
}) => {
  server.use(
    http.get("**/validate", () => HttpResponse.json({ success: true })),
  )

  const {{camelCase pluginName}}Api = new {{pascalCase pluginName}}API({
    ...dataSourceConfig,
    pluginSymbol: pluginConfig.name,
    settings: {},
  });
  const isValid = await {{camelCase pluginName}}Api.validate();

  expect(isValid).toBe(true);
});
