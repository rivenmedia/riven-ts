import type { CodegenConfig } from "@graphql-codegen/cli";
import type { TypeScriptPluginConfig } from "@graphql-codegen/typescript";
import type { TypeScriptDocumentsPluginConfig } from "@graphql-codegen/typescript-operations";

export default {
  schema: "http://localhost:3000",
  documents: ["lib/**/*.ts", "!lib/**/__generated__/**/*"],
  ignoreNoDocuments: true,
  overwrite: true,
  importExtension: ".ts",
  generates: {
    "./lib/types/__generated__/graphql.ts": {
      plugins: ["typescript"],
      config: {} satisfies TypeScriptPluginConfig,
    },
    "./lib/": {
      preset: "near-operation-file",
      presetConfig: {
        // This should be the file generated by the "typescript" plugin above,
        // relative to the directory specified for this configuration
        baseTypesPath: "./types/__generated__/graphql.ts",
        extension: ".typegen.ts",
      },
      plugins: ["typescript-operations"],
      // Note: these config options moved from the other generated file config
      config: {
        avoidOptionals: {
          // Use `null` for nullable fields instead of optionals
          field: true,
          // Allow nullable input fields to remain unspecified
          inputValue: false,
        },
        // Use `unknown` instead of `any` for unconfigured scalars
        defaultScalarType: "unknown",
        // Apollo Client always includes `__typename` fields
        nonOptionalTypename: true,
        // Apollo Client doesn't add the `__typename` field to root types so
        // don't generate a type for the `__typename` for root operation types.
        skipTypeNameForRoot: true,
      } satisfies TypeScriptDocumentsPluginConfig,
    },
  },
} satisfies CodegenConfig;
